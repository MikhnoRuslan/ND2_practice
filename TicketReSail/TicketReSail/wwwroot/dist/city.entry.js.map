{"version":3,"sources":["webpack://TicketReSail/./js/city.js"],"names":[],"mappings":";;;;;;AAAA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB;AACtB,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB,yDAAyD;AAC/E;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB;AACtB,SAAS;AACT;AACA;AACA,iDAAiD,QAAQ;AACzD;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL,Y","file":"city.entry.js","sourcesContent":["ï»¿const url = \"/api/v1/Cities\";\nconst jsonType = \"application/jcon\";\n\nasync function getCities() {\n    const response = await fetch(\"/api/v1/Cities\",\n        {\n            method: \"GET\",\n            headers: { \"Accept\": jsonType }\n        });\n    if (response.ok === true) {\n\n        const cities = await response.json();\n        let rows = document.querySelector(\"tbody\");\n        cities.forEach(city => {\n            rows.append(row(city));\n        });\n    }\n}\n\nasync function createCity(cityName) {\n    const response = await fetch(url,\n        {\n            method: \"POST\",\n            headers: { \"Accept\": jsonType, \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n                name: cityName\n            })\n        });\n    if (response.ok === true) {\n        const city = await response.json();\n        reset();\n        document.querySelector(\"tbody\").append(row(city));\n    } else {\n        const errorData = await response.json();\n        console.log(\"error\", errorData);\n        if (errorData) {\n\n            if (errorData.errors) {\n\n                if (errorData.error[\"Name\"]) {\n                    addError(errorData.errors[\"Name\"]);\n                }\n            }\n\n            if (errorData[\"Name\"]) {\n                addError(errorData[\"Name\"]);\n            }\n        }\n\n        document.getElementById(\"error\").style.display = \"block\";\n    }\n}\n\nasync function deleteCity(id) {\n    const response = await fetch(url + \"/\" + id,\n        {\n            method: \"DELETE\",\n            headers: { \"Accept\": jsonType }\n        });\n    if (response.ok === true) {\n        const city = await response.json();\n        document.querySelector(`tr[data-rowid='${city.id}']`).remove();\n    }\n}\n\nfunction reset() {\n    const form = document.forms[\"cityForm\"];\n    form.reset();\n    form.elements[\"id\"].value = 0;\n}\n\nfunction addError(errors) {\n    errors.forEach(error => {\n        const p = document.createElement(\"p\");\n        p.append(error);\n        document.getElementById(\"error\").append(p);\n    });\n}\n\nfunction row(city) {\n    const tr = document.createElement(\"tr\");\n    tr.setAttribute(\"data-rowid\", city.id);\n\n    const nameTd = document.createElement(\"td\");\n    nameTd.append(city.name);\n    tr.append(nameTd);\n\n    const linksTd = document.createElement(\"td\");\n\n    const removeLink = document.createElement(\"a\");\n    removeLink.setAttribute(\"data-id\", city.id);\n    removeLink.setAttribute(\"type\", \"submit\");\n    removeLink.setAttribute(\"class\", \"btn btn-sm btn-primary\");\n    removeLink.append(\"Delete\");\n    removeLink.addEventListener(\"click\", e => {\n\n        e.preventDefault();\n        deleteCity(city.id);\n    });\n\n    linksTd.append(removeLink);\n    tr.appendChild(linksTd);\n\n    return tr;\n}\n\n// send form\ndocument.forms[\"cityForm\"].addEventListener(\"submit\",\n    e => {\n        e.preventDefault();\n        document.getElementById(\"error\").innerHTML = \"\";\n        document.getElementById(\"error\").style.display = \"none\";\n\n        const form = document.forms[\"cityForm\"];\n        const id = form.elements[\"id\"].value;\n        const name = form.elements[\"name\"].value;\n        if (id == 0)\n            createCity(name);\n    });\n\ngetCities();"],"sourceRoot":""}