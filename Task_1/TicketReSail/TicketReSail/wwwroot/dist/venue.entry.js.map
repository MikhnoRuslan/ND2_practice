{"version":3,"sources":["webpack://TicketReSail/./js/venue.js"],"names":[],"mappings":";;;;;;AAAA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB,qBAAqB;AAC3C,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB;AACtB,SAAS;AACT;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB;AACtB,SAAS;AACT;;AAEA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB;AACtB,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB,yDAAyD;AAC/E;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB,yDAAyD;AAC/E;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA,iDAAiD,SAAS;AAC1D;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB;AACtB,SAAS;AACT;AACA;AACA,iDAAiD,SAAS;AAC1D;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL,Y","file":"venue.entry.js","sourcesContent":["ï»¿const url = \"/api/v1/Venues\";\nconst jsonType = \"application/jcon\";\n\nasync function fillCitySelector() {\n    const response = await fetch(\"/api/v1/cities\",\n        {\n            method: \"GET\",\n            headers: { 'Accept': jsonType },\n        });\n    if (response.ok === true) {\n\n        const cities = await response.json();\n        let selector = document.querySelector('#cities');\n        for (const city of cities) {\n            const option = document.createElement('option');\n            option.value = city.id;\n            option.append(city.id);\n            selector.append(option);\n        }\n    }\n}\n\nfunction singleSelectChangeValue() {\n    var selValue = document.getElementById(\"cities\").value;\n}\n\nfillCitySelector();\n\nasync function getCity(id) {\n    const response = await fetch(url + \"/\" + id,\n        {\n            method: \"GET\",\n            headers: { \"Accept\": jsonType }\n        });\n    if (response.ok === true) {\n        const city = await response.json();\n\n        return await city.name;\n    }\n}\n\nasync function getVenues() {\n    const response = await fetch(url,\n        {\n            method: \"GET\",\n            headers: { \"Accept\": jsonType }\n        });\n    if (response.ok === true) {\n\n        const venues = await response.json();\n        let rows = document.querySelector(\"tbody\");\n\n        venues.forEach(venue => {\n            rows.append(row(venue));\n        });\n    }\n}\n\nasync function getVenue(id) {\n    const response = await fetch(url + \"/\" + id,\n        {\n            method: \"GET\",\n            headers: { \"Accept\": jsonType }\n        });\n    if (response.ok === true) {\n        const venue = await response.json();\n        const form = document.form[\"venueForm\"];\n        form.elements[\"id\"].value = venue.id;\n        form.elements[\"name\"].value = venue.name;\n        form.elements[\"address\"].value = venue.address;\n        form.elements[\"cityId\"].value = venue.cityId;\n    }\n}\n\nasync function createVenue(venueName, venueAddress, citiId) {\n    const response = await fetch(url,\n        {\n            method: \"POST\",\n            headers: { \"Accept\": jsonType, \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n                name: venueName,\n                address: venueAddress,\n                cityId: citiId\n            })\n        });\n    if (response.ok === true) {\n        const venue = await response.json();\n        reset();\n        document.querySelector(\"tbody\").append(row(venue));\n    } else {\n        const errorData = await response.json();\n        console.log(\"error\", errorData);\n        if (errorData) {\n\n            if (errorData.errors) {\n\n                if (errorData.error[\"Name\"]) {\n                    addError(errorData.errors[\"Name\"]);\n                }\n            }\n\n            if (errorData[\"Name\"]) {\n                addError(errorData[\"Name\"]);\n            }\n        }\n\n        document.getElementById(\"error\").style.display = \"block\";\n    }\n}\n\nasync function editVenue(venueId, venueName, venueAddress, cityId) {\n    const response = await fetch(url,\n        {\n            method: \"PUT\",\n            headers: { \"Accept\": jsonType, \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n                id: parseInt(venueId, 10),\n                name: venueName,\n                address: venueAddress,\n                cityId: parseInt(cityId, 10)\n            })\n        });\n    if (response.ok === true) {\n        const venue = await response.json();\n        reset();\n        document.querySelector(`tr[data-rowid='${venue.id}']`).replaceWith(row(venue));\n    }\n}\n\nasync function deleteVenue(id) {\n    const response = await fetch(url + \"/\" + id,\n        {\n            method: \"DELETE\",\n            headers: { \"Accept\": jsonType }\n        });\n    if (response.ok === true) {\n        const venue = await response.json();\n        document.querySelector(`tr[data-rowid='${venue.id}']`).remove();\n    }\n}\n\nfunction reset() {\n    const form = document.forms[\"venueForm\"];\n    form.reset();\n    form.elements[\"id\"].value = 0;\n}\n\nfunction addError(errors) {\n    errors.forEach(error => {\n        const p = document.createElement(\"p\");\n        p.append(error);\n        document.getElementById(\"error\").append(p);\n    });\n}\n\nfunction row(venue) {\n\n    venue.city = getCity(venue.cityId);\n\n    const tr = document.createElement(\"tr\");\n    tr.setAttribute(\"data-rowid\", venue.id);\n\n    const nameTd = document.createElement(\"td\");\n    nameTd.append(venue.name);\n    tr.append(nameTd);\n\n    const addressTd = document.createElement(\"td\");\n    addressTd.append(venue.address);\n    tr.append(addressTd);\n\n    const cityIdTd = document.createElement(\"td\");\n    cityIdTd.append(venue.city.name);\n    tr.append(cityIdTd);\n\n    const linksTd = document.createElement(\"td\");\n\n    const editLink = document.createElement(\"a\");\n    editLink.setAttribute(\"data-id\", venue.id);\n    editLink.setAttribute(\"type\", \"submit\");\n    editLink.setAttribute(\"class\", \"btn btn-sm btn-primary\");\n    editLink.append(\"Edit\");\n    editLink.addEventListener(\"click\", e => {\n\n        e.preventDefault();\n        getVenue(venue.id);\n    });\n    linksTd.append(editLink);\n\n    const removeLink = document.createElement(\"a\");\n    removeLink.setAttribute(\"data-id\", venue.id);\n    removeLink.setAttribute(\"type\", \"submit\");\n    removeLink.setAttribute(\"class\", \"btn btn-sm btn-primary\");\n    removeLink.append(\"Delete\");\n    removeLink.addEventListener(\"click\", e => {\n\n        e.preventDefault();\n        deleteVenue(venue.id);\n    });\n\n    linksTd.append(removeLink);\n    tr.appendChild(linksTd);\n\n    return tr;\n}\n\n// send form\ndocument.forms[\"venueForm\"].addEventListener(\"submit\",\n    e => {\n        e.preventDefault();\n        document.getElementById(\"error\").innerHTML = \"\";\n        document.getElementById(\"error\").style.display = \"none\";\n        document.getElementById(\"cityId\");\n\n        const form = document.forms[\"venueForm\"];\n        const id = form.elements[\"id\"].value;\n        const name = form.elements[\"name\"].value;\n        const address = form.elements[\"address\"].value;\n        // const cityId = form.elements[\"cityId\"].value;\n        if (id == 0)\n            createVenue(name, address, singleSelectChangeValue());\n        else\n            editVenue(id, name, address, singleSelectChangeValue());\n    });\n\ngetVenues();"],"sourceRoot":""}