{"version":3,"sources":["webpack://TicketReSail/./js/category.js"],"names":[],"mappings":";;;;;;AAAA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB,qBAAqB;AAC3C,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB;AACtB,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB,yDAAyD;AAC/E;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB;AACtB,SAAS;AACT;AACA;AACA,iDAAiD,YAAY;AAC7D;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL,gB","file":"category.entry.js","sourcesContent":["ï»¿const url = \"/api/v1/categories\";\nconst jsonType = \"application/jcon\";\n\nasync function fillCategorySelector() {\n    const response = await fetch(\"/api/v1/categories\",\n        {\n            method: \"GET\",\n            headers: { 'Accept': jsonType },\n        });\n    if (response.ok === true) {\n\n        const categories = await response.json();\n        let selector = document.querySelector('#categories');\n        for (const category of categories) {\n            const option = document.createElement('option');\n            option.value = category.id;\n            option.append(category.name);\n            selector.append(option);\n            console.log(option);\n        }\n    }\n}\n\nfillCategorySelector()\n\nasync function getCategories() {\n    const response = await fetch(url,\n        {\n            method: \"GET\",\n            headers: { \"Accept\": jsonType }\n        });\n    if (response.ok === true) {\n\n        const categories = await response.json();\n        let rows = document.querySelector(\"tbody\");\n        categories.forEach(category => {\n            rows.append(row(category));\n        });\n    }\n}\n\nasync function createCategory(categoryName) {\n    const response = await fetch(url,\n        {\n            method: \"POST\",\n            headers: { \"Accept\": jsonType, \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n                name: categoryName\n            })\n        });\n    if (response.ok === true) {\n        const category = await response.json();\n        reset();\n        document.querySelector(\"tbody\").append(row(category));\n    } else {\n        const errorData = await response.json();\n        console.log(\"error\", errorData);\n        if (errorData) {\n\n            if (errorData.errors) {\n\n                if (errorData.error[\"Name\"]) {\n                    addError(errorData.errors[\"Name\"]);\n                }\n            }\n\n            if (errorData[\"Name\"]) {\n                addError(errorData[\"Name\"]);\n            }\n        }\n\n        document.getElementById(\"error\").style.display = \"block\";\n    }\n}\n\nasync function deleteCategory(id) {\n    const response = await fetch(url + \"/\" + id,\n        {\n            method: \"DELETE\",\n            headers: { \"Accept\": jsonType }\n        });\n    if (response.ok === true) {\n        const category = await response.json();\n        document.querySelector(`tr[data-rowid='${category.id}']`).remove();\n    }\n}\n\nfunction reset() {\n    const form = document.forms[\"categoryForm\"];\n    form.reset();\n    form.elements[\"id\"].value = 0;\n}\n\nfunction addError(errors) {\n    errors.forEach(error => {\n        const p = document.createElement(\"p\");\n        p.append(error);\n        document.getElementById(\"error\").append(p);\n    });\n}\n\nfunction row(category) {\n    const tr = document.createElement(\"tr\");\n    tr.setAttribute(\"data-rowid\", category.id);\n\n    const nameTd = document.createElement(\"td\");\n    nameTd.append(category.name);\n    tr.append(nameTd);\n\n    const linksTd = document.createElement(\"td\");\n\n    const removeLink = document.createElement(\"a\");\n    removeLink.setAttribute(\"data-id\", category.id);\n    removeLink.setAttribute(\"type\", \"submit\");\n    removeLink.setAttribute(\"class\", \"btn btn-sm btn-primary\");\n    removeLink.append(\"Delete\");\n    removeLink.addEventListener(\"click\", e => {\n\n        e.preventDefault();\n        deleteCategory(category.id);\n    });\n\n    linksTd.append(removeLink);\n    tr.appendChild(linksTd);\n\n    return tr;\n}\n\n// send form\ndocument.forms[\"categoryForm\"].addEventListener(\"submit\",\n    e => {\n        e.preventDefault();\n        document.getElementById(\"error\").innerHTML = \"\";\n        document.getElementById(\"error\").style.display = \"none\";\n\n        const form = document.forms[\"categoryForm\"];\n        const id = form.elements[\"id\"].value;\n        const name = form.elements[\"name\"].value;\n        if (id == 0)\n            createCategory(name);\n    });\n\ngetCategories();"],"sourceRoot":""}